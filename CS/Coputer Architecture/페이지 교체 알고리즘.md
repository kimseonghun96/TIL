## 페이지 교체 알고리즘

- 페이징
  
  물리 메모리를 일정한 크기인 **Frame**으로 나누고, 논리 메모리를 Frame과 동일한 크기의 **Page**로 나눈다.
  
  이후 필요한 Page를 Frame에 적재하고 실행한다.
  
  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/3f24c420-6b58-4028-bd07-d8f9b30a408b/Untitled.png)
  
  - 각 Page는 연속적이지 않은 공간에 존재할 수 있다.
  - 각 프로세스는 각자의 Page Table 을 가진다.
  
  ### **장점**
  
  - 가상메모리 사용의 장점을 가진다.
  - 외부단편화가 발생하지 않는다.
    - Frame의 크기와 Page의 크기가 동일하기 때문이다.
  
  ### **단점**
  
  - 내부단편화가 발생한다.
    - 마지막 Frame에서 physical memory가 frame 크기로 나누어 떨어지지 않을 경우

**요약**

1. 현재 공간에 필요한 페이지가 없는 상황

2. 새로운 페이지를 현재 공간에 할당을 해야

3. 공간이 꽉 차서 지금 들어있는 것들 중에

4. 어떤 것을 빼서 공간을 만들어줘야

5. Winter is comming 이어서 서랍에 내복이나 두꺼운 옷 등을 넣어야 하는 상황

6. 겨울에 입을 옷들을 서랍에 넣어 놓아야 꺼내 입기 편함

7. 지금 서랍에 여름 옷이나 이런 것들로 가득함

8. 안 입을 옷들을 빼서 공간을 만들어주고
   
   그 공간에 필요한 옷을 넣는 것

### 설명

가상 메모리는 요구 페이지 기법을 통해 필요한 페이지만 메모리에 적재하고 사용하지 않는 부분은 그대로 보관

→ 옷을 사도 결국 입는 것만 입고, 안 입을 옷이라도 계절에 맞는 옷이라면 서랍에 보관

- 가상 메모리
  
  메인 메모리를 2차 저장장치(디스크)의 캐시로 사용하는 기술
  
  메인 메모리 ↔ 디스크
  
  디스크에 들어가 있는 방대한 내용들을 메인 메모리에 다 담을 수 없으니
  
  필수 내용들을 메인 메모리에 담고 필요할 때마다 디스크에서 가져다 쓸 수 있도록
  
  - 여러 프로그램들이 효과적이고 안전하게 **메인 메모리**를 **공유**할 수 있게 하기 위하여
  - 프로세스 전체가 메모리 내에 올라오지 않더라도 실행이 가능하도록 하는 기법이다.
    - 실행에 필요한 부분만 메모리에 올려 실행
  - CPU는 TLB, MMU 를 사용하여 가상 메모리 주소에 접근한다.

- 요구 페이징 기법
  
  정의
  
  프로세스가 실행되는 동안 필요한 페이지만 메모리에 올리고
  
  필요하지 않은 페이지는 디스크에 저장하여 메모리를 절약하는 방법
  
  방법
  
  페이지 테이블에 페이지의 위치 정보와 함께 각 페이지의 접근 여부를 표시하여 필요한 페이지만 메모리에 올림
  
  상세 설명
  
  [[OS] 요구 페이징](https://superohinsung.tistory.com/127)

하지만 필요한 페이지만 올려도 메모리는 결국 가득 차게 되고, 올라와있던 페이지가 사용이 다 된 후에도 자리만 차지하고 있을 수 있다.

→ 서랍의 크기는 한정되어 있고, 옷을 입고 세탁하고 다시 서랍에 들어가는 상황

다른 옷을 넣기에는 공간이 부족

따라서 메모리가 가득 차면, 추가로 페이지를 가져오기 위해서 안쓰는 페이지는 out하고,

→ 계절이 바뀌어서 다른 옷을 넣기 위해서는 잘 안입는 옷들은 따로 빼야

해당 공간에 현재 필요한 페이지를 in 시켜야 한다.

→ 빈 공간에 필요한 옷들을 넣어야.

여기서 어떤 페이지를 out 시켜야 할 지 정해야 한다.

**Victim Page**

out되는 페이지

빈 프레임이 없을 때 빠질 페이지

기왕이면 수정이 되지 않는 페이지를 선택해야 좋다.

**이유**

만약 수정되면 메인 메모리에서 내보낼 때, 하드디스크에서 또 수정을 진행해야 하므로 시간이 오래 걸림

예를 들어, 니트만 입으면 좀 불편하니까 안에 받쳐입을 옷들이 필요한데

그런 옷들까지 서랍에서 빼놓고 다른 곳에 보관하면 매번 빼서 입기 귀찮으니까

입을 만한 옷들은 서랍에 넣어 놓는게 편함

### Page Reference String

**페이지 결함 (Page Fault)**

필요한 페이지가 메모리에 없을 때 발

공간이 가득 차서 새로운 페이지를 넣고, 기존에 있는 페이지를 뺄 때 발생

페이지 교체 알고리즘은 이런 page fault 발생 비율을 줄이는 것을 목표

CPU는 논리 주소를 통해 특정 주소를 요구함

메인 메모리에 올라와 있는 주소들은 페이지의 단위로 가져오기 때문에 페이지 번호가 연속되어 나타나게 되면 페이지 결함 발생 X

따라서 CPU의 주소 요구에 따라 페이지 결함이 일어나지 않는 부분은 생략하여 표시하는 방법이 바로 **Page Reference String**

![page reference string.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/0b336cd5-98d8-4d21-a2d8-039b690ec1e5/page_reference_string.jpg)

[[운영체제(OS)] 16. 페이지 교체 알고리즘](https://velog.io/@codemcd/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-16.-%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B5%90%EC%B2%B4-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98)

### 페이지 교체 알고리즘 종류

1. **F**irst **I**n **F**irst **O**ut 알고리즘
   
   First In First Out
   
   메모리에 먼저 올라온 페이지를 먼저 내보내는 알고리즘
   
   들어온 시간을 저장하거나 올라온 순서를 Queue를 이용해 저장할 수 있음
   
   Victim Page = out 되는 페이지
   
   가장 먼저 메모리에 올라온 페이지
   
   간단한 방법
   
   초기화 코드에서 적절한 방법
   
   - 초기화 코드
     
     처음 프로세스 실행될 때 최초 초기화를 시키는 역할
     
     다른 역할은 수행하지 않으므로, 메인 메모리에서 빼도 괜찮음
   
   하지만 처음 프로세스 실행시에는 무조건 필요한 코드
   
   FIFO 알고리즘을 사용하면 초기화를 시켜준 후 가장 먼저 내보내는 것이 가능함
   
   ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/fbaa76b9-6a58-42a7-ac4f-71f3da75877f/Untitled.png)
   
   ![페이지 교체 알고리즘 - fifo.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/dd2fcc46-de77-413f-a0aa-0d241407abf4/%ED%8E%98%EC%9D%B4%EC%A7%80_%EA%B5%90%EC%B2%B4_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98_-_fifo.jpg)

2. **OPT**imal 알고리즘
   
   앞으로 가장 사용하지 않을 페이지를 가장 우선적으로 내보냄
   
   FIFO에 비해 페이지 결함의 횟수를 많이 감소시킬 수 있음
   
   실질적으로 페이지가 앞으로 잘 사용되지 않을 것이라는 보장이 없기 때문에 수행하기 어려운 알고리즘임
   
   프로세스가 앞으로 사용할 페이지를 미리 알아야한다.
   
   실제로 구현하기 거의 불가능
   
   연구 목적을 위해 사용
   
   다른 알고리즘이랑 비교용으로
   
   ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/74fd05e2-18ae-43d0-96cf-66acf7189977/Untitled.png)
   
   ![페이지 교체 알고리즘 - opt.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/13c4bde6-7dfe-4075-94d3-68fe90bd13c4/%ED%8E%98%EC%9D%B4%EC%A7%80_%EA%B5%90%EC%B2%B4_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98_-_opt.jpg)
   
   [[운영체제] 페이지 교체 알고리즘 (FIFO/OPT/LRU/LFU/MFU)](https://code-lab1.tistory.com/60)

3. **L**east **R**ecently **U**sed 알고리즘
   
   최근에 사용하지 않은 페이지를 가장 먼저 내려보내는 알고리즘
   
   OPT의 경우 미래 예측이지만, LRU의 경우는 과거를 보고 판단
   
   실질적으로 사용이 가능한 알고리즘
   
   → 옷장에서 옷을 뺄 때도 가장 안 입은 옷들을 제거, 버리거나
   
   실제로 사용할 수 있는 페이지 교체 알고리즘에서는 가장 좋은 방법 중 하나임
   
   많은 운영체제에서 채택
   
   ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/04132835-84b6-441c-ba62-95170b1d570c/Untitled.png)
   
   ![페이지 교체 알고리즘 - lru.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/e38e56e8-43ad-475b-b9bb-517b61398549/%ED%8E%98%EC%9D%B4%EC%A7%80_%EA%B5%90%EC%B2%B4_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98_-_lru.jpg)

4. **L**east **F**requetly **U**sed 알고리즘 - **추가**
   
   참조 횟수가 가장 적은 페이지를 교체하는 알고리즘
   
   교체 대상이 여러 개라면 가장 오랫동안 사용하지 않은 페이지를 교체
   
   ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/7bcd98fc-8c1e-4414-a142-5d6fca03e8ca/Untitled.png)
   
   ![페이지 교체 알고리즘 - lfu.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/2159b626-3234-4eee-8410-6de2c8259ea5/%ED%8E%98%EC%9D%B4%EC%A7%80_%EA%B5%90%EC%B2%B4_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98_-_lfu.jpg)

5. **M**ost **F**requently **U**sed 알고리즘 - **추가**
   
   MFU 알고리즘은 LFU와 반대로 참조 횟수가 가장 많은 페이지를 교체하는 알고리즘
   
   ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/67cd884f-8852-443c-9bf6-6568bfe0f00b/Untitled.png)
   
   ![페이지 교체 알고리즘 - mfu.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/be11b1d0-6238-49c3-9c43-b3d3db9ba37a/%ED%8E%98%EC%9D%B4%EC%A7%80_%EA%B5%90%EC%B2%B4_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98_-_mfu.jpg)
   
   이전에 참조했던 기록을 남겨놓아야 누가 참조를 가장 많이 했는지 알 수 있다.

### 교체 방식

**종류**

1. Global 교체
   
   메모리 상의 모든 프로세스 페이지에 대해 교체하는 방식

2. Local 교체
   
   메모리 상의 자기 프로세스 페이지에서만 교체하는 방식

**이유**

다중 프로그래밍의 경우, 메인 메모리에 다양한 프로세스가 동시에 올라올 수 있음

다양한 프로세스의 페이지가 메모리에 존재함

페이지 교체 시, 다양한 페이지 교체 알고리즘을 활용해 victim page를 선정하는데

out 시킬 페이지를 선정

선정 기준을 Global로 하느냐, Local로 하느냐에 대한 차이

**더 효율적인 방법**

전체를 기준으로 페이지를 교체하는 것이 더 효율적

**이유**

자기 프로세스 페이지에서만 교체를 진행할 경우

교체를 해야할 때 각각 모두 교체를 진행해야 하므로 비효율적
