### ****세마포어(Semaphore) & 뮤텍스(Mutex)****

**Inter-Process Communication (IPC)은 두 개 이상의 프로세스 간에 데이터를 교환하고 통신하기 위한 메커니즘. (프로세스는 독립적으로 실행되기 때문 - 외부 접근을 막음, OS가 보장)**

**IPC 통신(**공유된 자원에 여러 프로세스가 동시에 접근**)에서 프로세스 간 데이터를 동기화하고 보호하기 위해 세마포어와 뮤텍스를 사용한다. (공유된 자원에 한번에 하나의 프로세스만 접근시킬 때)**

**세마포어**: 현재 공유자원에 접근할 수 있는 쓰레드, 프로세스의 수를 나타내는 값을 두어 상호배제를 달성하는 기법

- **비유:** 세마포어는 입장을 허락하는 번호표.
- **역할:** 한정된 번호표(자원의 개수)를 소유하고, 이 번호표로 자원에 접근할 수 있습니다. 사용하면 번호표는 하나씩 줄어들고, 반납하면 번호표는 하나씩 늘어납니다.
- **사용 예시:** 프린터가 세마포어로 보호될 경우, 한 번에 프린터를 사용할 수 있는 프로세스(사용자) 수를 제한할 수 있습니다.

**뮤텍스**: 한 쓰레드, 프로세스에 의해 소유될 수 있는 **Key**🔑를 기반으로 한 상호배제기법

- **비유:** 뮤텍스는 화장실의 열쇠.
- **역할:** 누가 화장실을 사용할지를 결정하는 열쇠를 가지고 있습니다. 사용하면 열쇠를 잠그고, 나오면 열쇠를 풀어서 다른 사람이 사용할 수 있게 합니다.
- **사용 예시:** 파일에 뮤텍스를 두면 한 번에 하나의 프로세스만 그 파일을 읽거나 쓸 수 있습니다.

**임계 구역(Critical Section)**

여러 프로세스가 데이터를 공유하며 수행될 때, **각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 부분**

→ **공유된 자원에 접근하여 작업을 수행하는 코드 영역**

공유 데이터를 여러 프로세스가 동시에 접근할 때 잘못된 결과를 만들 수 있기 때문에, 한 프로세스가 임계 구역을 수행할 때는 다른 프로세스가 접근하지 못하도록 해야 한다.

```python
## 세마포어

(일반적으로 세마포어는 0 이상의 값을 가지며, 
이 값은 몇 개의 프로세스 또는 스레드가 동시에 임계구역 진입할 수 있는 지 보여줌)

procedure P(S)   --> 최초 S값은 1임 
    while S=0 do wait  --> S가 0면 1이 될때까지 기다려야 함
    S := S-1   --> S를 0로 만들어 다른 프로세스가 들어 오지 못하도록 함
end P

--- 임계 구역 ---

procedure V(S) --> 현재상태는 S가 0임
    S := S+1   --> S를 1로 원위치시켜 해제하는 과정
end V
```

이를 통해, 한 프로세스가 P 혹은 V를 수행하고 있는 동안 프로세스가 인터럽트 당하지 않게 된다. P와 V를 사용하여 임계 구역에 대한 상호배제 구현이 가능하게 되었다.

1. 먼저 도착한 A가 P(S)를 실행하여 S를 0으로 만들고 임계구역에 들어감
2. 그 뒤에 도착한 B가 P(S)를 실행하지만 S가 0이므로 대기 상태
3. A가 임계구역 수행을 마치고 V(S)를 실행하면 S는 다시 1이 됨
4. B는 이제 P(S)에서 while문을 빠져나올 수 있고, 임계구역으로 들어가 수행함

### Mutex 뮤텍스

: 공유된 자원의 데이터 혹은 임계영역(Critical Section) 등에 `하나`의 Process 혹은 Thread가 접근하는 것을 막아줌 (동기화 대상이 하나)

임계구역(Critical Section)을 가진 스레드들의 실행시간(Running Time)이 서로 겹치지 않고 각각 단독으로 실행(상호배제_Mutual Exclusion)되도록 하는 기술.

뮤텍스는 상태가 0, 1로 **이진 세마포어**로 부르기도 함

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/967b3061-a715-4962-9b50-6008e2fb1d82/Untitled.png)

한 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제 기법이고 Key에 해당하는 어떤 객체(Object)가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있습니다.

다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용함으로써 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없습니다.

### Semaphore 세마포어

: 공유된 자원의 데이터 혹은 임계영역(Critical Section) 등에 `여러` Process 혹은 Thread가 접근하는 것을 막아줌 (동기화 대상이 하나 이상)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/508e4892-0806-4de8-bdcd-6846439ea664/995fdc29-e9d8-4ac3-ad01-c99c239dcb92/Untitled.png)

사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성합니다. 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있으며, 각 프로세스는 세마포어의 값을 확인하고 변경할 수 있습니다.

자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용하고. 이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면, 재시도 전에 일정시간 대기해야 합니다.

일반적으로 비교적 긴 시간을 확보하는 리소스에 대해 사용하게 됩니다

### 차이점

가장 큰 차이점은 동기화 대상의 개수 즉, 위에서 예시든 화장실의 갯수 입니다.

- Mutex는 동기화 대상이 오직 1개일 때 사용하며, Semaphore는 동기화 대상이 1개 이상일 때 사용합니다.
- Mutex는 자원을 소유할 수 있고, 책임을 가지는 반면 Semaphore는 자원 소유가 불가합니다.
- Mutex는 상태가 0, 1 뿐이므로 Lock을 가질 수 있고, 소유하고 있는 스레드만이 이 Mutex를 해제할 수 있습니다. 반면 Semaphore는 Semaphore를 소유하지 않는 스레드가 Semaphore를 해제할 수 있습니다.

이러한 특성 차이로 인해 Mutex는 주로 상호 배제(Mutual Exclusion)를 위해 사용되고, Semaphore는 자원의 제한된 가용성을 표현하기 위해 사용
