## 경쟁 상태(Race Condition)

### 정의

공유 자원에 대해 여러 프로세스가 동시에 접근할 때, 결과값에 영향을 줄 수 있는 상태

동시 접근 시 자료의 일관성을 해치는 결과가 나타남

- 공유 자원
  
  여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일등
  
  누가 언제 데이터를 읽거나 쓰느냐에 따라 그 결과가 달라질 수 있음
  
  프로세스들의 *공유 자원 접근 순서*를 정하여 예상치 못한 문제가 발생하지 않도록

- 동시 접근 방지
  
  DB의 동시성 문제 해결
  
  Transaction
  
  [DB - 동시성 제어와 lock](https://jackcokebb.tistory.com/16)
  
  언어별 multi thread에서 동시성 접근 제어
  
  Java - synchronize
  
  [[Java] Multi Thread환경에서 동시성 제어를 하는 방법](https://deveric.tistory.com/104)
  
  Python - Global Interpreter Lock
  
  [python 동시성 관리 (2) - GIL(Global Interpreter Lock)](https://velog.io/@jaebig/python-%EB%8F%99%EC%8B%9C%EC%84%B1-%EA%B4%80%EB%A6%AC-2-GILGlobal-Interpreter-Lock)
  
  C++ - std::thread / std::mutex
  
  [C++ std::thread와 std::mutex를 사용한 멀티스레딩 예제](https://kjm99d.tistory.com/22)
  
  Javascript - 중복클릭방지
  
  Semaphore
  
  [[javascript] 중복클릭 방지 - 세마포어 이용하기](https://hyeonguj.github.io/2020/02/27/double-click-problem-javascript/)

### 발생하는 경우

1. 커널 작업을 수행하는 중에 인터럽트 발생
   
   - 커널
     
     OS: 커널과 함께 사용자 편의를 위한 시스템 프로그램
     
     커널
     
     컴퓨터 자원을 관리하는 운영체제의 핵심 부분
     
     사용자와의 상호작용은 전혀 지원하지 않음
     
     역할
     
     보안, 자원 관리, 추상화
     
     [[OS] 커널(kernel)이란 ?](https://velog.io/@ragnarok_code/OS-%EC%BB%A4%EB%84%90kernel%EC%9D%B4%EB%9E%80)
     
     [[운영체제] 유저모드와 커널모드에 대해서.](https://blockdmask.tistory.com/69)
   
   - 인터럽트
     
     작업 하던 중에 갑자기 더 중요한 일이 발생해서 해당 일을 CPU에게 먼저 처리하라고 알리는 것
   
   문제점
   
   커널 모드에서 데이터를 로드하여 작업을 수행하다가 인터럽트가 발생하여 같은 데이터를 조작하는 경우
   
   해결법
   
   커널모드에서 작업을 수행하는 동안, 인터럽트를 disable 시켜 CPU 제어권을 가져가지 못하도록 한다.
- 인터럽트를 방지하는 방법
  
  인터럽트 서비스 루틴을 실행할 때 인터럽트 플래그(IF)를 0으로 하면 인터럽트 발생을 방지
  
  인터럽트 플래그
  
  상태 레지스터 안에 있는 제어 플래그
  
  외부 인터럽트 허가 여부를 결정
2. 프로세스가 System Call을 하여 커널 모드로 진입하여 작업을 수행하는 도중에 문맥 교환이 발생할 때
   
   문제점
   
   프로세스1이 커널모드에서 데이터를 조작하는 도중, 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우 ( 프로세스2가 작업에 반영되지 않음 )
   
   해결법
   
   프로세스가 커널모드에서 작업을 하는 경우 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가지 않도록 함
   
   - System Call
     
     운영 체제의 커널이 제공하는 서비스에 대해, 응용 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스
     
     보통 C나 C++과 같은 고급 언어로 작성된 프로그램들은 직접 시스템 호출을 사용할 수 없기 때문에 고급 API를 통해 시스템 호출에 접근하게 하는 방법
     
     반드시 **kernel**에 관련된 것은 커널모드로 전환한 후에야, 해당 작업을 수행할 권한
     
     커널 모드를 통한 이러한 작업은 반드시 **시스템 콜**을 통해 수행하도록 설계
     
     [[운영체제] 시스템 콜 (System Call)](https://fjvbn2003.tistory.com/306)
   
   - 커널 모드
     
     모든 자원(드라이버, 메모리, CPU 등)에 접근, 명령
     
     프로세스가 실행되는 동안에 프로세스는 수없이 유저모드와 커널모드를 왔다갔다 하면서 실행
     
     유저모드 -> 커널모드 요청
     
     프로세스가 유저모드에서 실행되다가 특별한 요청이 필요할 때 system call을 이용해서 커널에 요청
     
     커널모드 -> 유저모드로 반환
     
     system call의 요청을 받은 커널이 그 요청에 대한 일을 하고 결과값을 system call의 리턴 값으로 전달
   
   - 문맥 교환
     
     Context Switching
     
     CPU가 이전의 프로세스 상태를 PCB에 보관하고, 또 다른 프로세스의 정보를 PCB에 읽어 레지스터에 적재하는 과정
     
     PCB
     
     프로세스 메타데이터들을 저장해 놓는 곳
     
     프로세스 메타데이터
     
     프로세스들의 특징

3. 멀티 프로세서 환경에서 공유 메모리 내의 커널 데이터에 접근할 때
   
   문제점
   
   멀티 프로세서 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우
   
   해결법
   
   커널 내부에 있는 각 공유 데이터에 접근할 때마다, 그 데이터에 대한 lock/unlock을 하는 방법
   
   - lock
     
     공유 자원에 대한 동기화 메커니즘
     
     가장 일반적인 메커니즘이 Lock
- 경쟁 / 교착 / 기아 상태
  
  [[OS] 경쟁상태, 교착상태, 기아상태](https://velog.io/@kku64r/deadlock)
