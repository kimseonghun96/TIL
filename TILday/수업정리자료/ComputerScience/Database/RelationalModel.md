# 관계 데이터 모델

## 1. 관계 데이터 모델

### 릴레이션

스키마와 인스턴스로 이루어졌으며, 행과 열로 구성된 테이블을 일컫는다.

<img title="" src="https://user-images.githubusercontent.com/109272360/194717296-688f2971-9922-4ebd-b784-57ccced2761f.png" alt="" data-align="center" width="643">

**스키마(schema)**

- 릴레이션의 기본적인 구조를 정의한다. 테이블에서는 첫 행인 헤더에 나타나며, 각 데이터의 특징을 나타내는 속성, 타입 등의 정보를 담고 있다.

- 속성: 릴레이션 스키마의 열이다. 속성을 보면 어떤 정보가 담겨있는지 알 수 있다.

- 도메인: 각 속성이 어떤 값을 가질 수 있는지 정의

- 차수: 속성의 개수

- 스키마의 여러가지 표기법
  
  - '릴레이션 이름(속성1, 속성2, 속성3, ...)'
  
  - '릴레이션 이름(속성1: 도메인1, 속성2: 도메인2, 속성3: 도메인3)'
  
  - ex) 도서(도서번호, 도서이름, 출판사, 가격)

**인스턴스(instance)**

- 정의된 스키마에 따라 테이블에 실제로 저장되는 데이터의 집합을 의미한다. 인스턴스의 각각의 행을 튜플이라 한다.

- 튜플: 릴레이션의 행이다. 스키마에서 정의한 도메인 값으로 구성된다. 모든 튜플들의 값은 서로 중복되지 않아야 한다.

- 카디날리티: 튜플의 개수

**릴레이션은 내부와 외부로 관계를 맺는다.**

- 내부: 한 행의 원소들이 관계를 맺어 하나의 인스턴스가 된다.
- 외부: '릴레이션 간의 관계'로, 식별 가능한 값을 이용해 관계를 맺는다.

**※ 릴레이션과 테이블 용어 정리**

| 릴레이션 용어 | 같은 의미로 통용되는 용어 | 파일 시스템 용어 |
| ------- | -------------- | --------- |
| 릴레이션    | 테이블            | 파일        |
| 스키마     | 내포             | 헤더        |
| 인스턴스    | 외연             | 데이터       |
| 튜플      | 행              | 레코드       |
| 속성      | 열              | 필드        |

**릴레이션의 특징**

- 속성은 단일 값을 가진다.

- 속성은 서로 다른 이름을 가진다.

- 한 속성의 값은 모두 같은 도메인 값을 가진다.

- 속성의 순서는 상관없다.

- 릴레이션 내의 중복된 튜플은 허용하지 않는다.

- 튜플의 순서는 상관없다.

### 관계 데이터 모델

관계 데이터 모델은 릴레이션에 대한 제약조건과 관계 연산을 위한 관계대수를 정의한다. 

이러한 관계 데이터 모델을 컴퓨터 시스템에 구현한 것을 **관계 데이터베이스 시스템**이라고 한다. 

관계 데이터베이스 시스템은 관계 데이터 모델에 기초하여 **SQL**을 기반으로 구현된다.

## 2. Key

### Key

릴레이션에서 특정 튜플을 식별할 때 사용하는 속성 혹은 속성의 집합이다.

키는 릴레이션 간의 관계를 맺는 데도 사용된다.

<img title="" src="https://user-images.githubusercontent.com/109272360/194717942-92f90e60-9761-485e-b154-0621d59cec16.png" alt="" data-align="center" width="581">

- **슈퍼키(super key)**: 튜플을 유일하게 식별할 수 있는 하나의 속성 혹은 속성의 집합이다. 튜플을 유일하게 식별할 수 있는 값이 포함된 집합이면 어떤 집합으로 묶여도 중복되지 않기 때문에, 모두 슈퍼키가 된다. 고객 릴레이션을 예시로 하면, 다음과 같다.
  
  ex) (주민번호), (고객번호), (고객번호, 주민번호), (주민번호, 이름), (주민번호, 이름, 주소), ...

- **후보키(candidate key)**: 튜플을 유일하게 식별할 수 있는 속성의 최소 집합이다. 위의 슈퍼키 예시에서 후보키는 (주민번호), (고객번호)이다. 하지만 주문 릴레이션의 경우 '고객번호'와 '도서번호'가 중복으로 나타나는 경우가 발생하기 때문에, '고객번호'와 '도서번호' 각각은 후보키가 될 수 없다. 만약 한 고객이 같은 도서를 다시 구매할 수 없다고 가정한다면, (고객번호, 도서번호) 만이 후보키가 될 수 있다.

- **기본키(primary key, PK)**: 여러 후보키 중 하나를 선정하여 대표로 삼는 키를 말한다. 릴레이션의 특성을 반영해, 기본키를 선정한다. 예를 들어, 고객 릴레이션에서 후보키는 '주민번호'와 '고객번호'가 될 수 있지만, 주민번호는 개인정보 보호에 취약할 수 있다. 따라서 '고객번호'를 선택하는 것이 권장된다.
  
  릴레이션 스키마를 표현할 때 기본키는 다음과 같이 밑줄을 그어 표시한다.
  
  릴레이션 이름(<U>속성1</U>, 속성2, 속성3, ...)
  
  ※ 기본키 선정 시 고려사항
  
  - 후보키여야 한다.
  
  - NULL 값은 허용하지 않는다.
  
  - 키 값의 변동이 일어나지 않아야 한다.
  
  - 향후 키를 사용하는 데 있어서 문제 발생 소지가 없어야 한다.

- **대리키(surrogate key = 인조키, artificial key)**: 일련번호 같은 가상의 속성을 만들어 기본키로 삼는 키를 말한다. 기본키가 보안을 요하거나, 여러 개의 속성으로 구분되어 복잡하거나, 마땅한 기본키가 없을 때 사용된다. 주문 릴레이션의 경우 (고객번호, 도서번호)를 기본키로 사용하지 않고, '주문번호' 속성을 만들어 기본키로 사용할 수 있다.

- **대체키(alternate key)**: 기본키로 선정되지 않은 후보키를 말한다. 고객 릴레이션의 경우, '고객번호'를 기본키로 정하면 '주민번호'가 대체키가 된다.

- **외래키(foreign key, FK)**: 다른 릴레이션의 기본키를 참조하는 속성을 말한다. 관계 데이터 모델의 특징인 릴레이션 간의 관계를 표현한다. 주문 릴레이션의 '고객번호'와 '도서번호'가 외래키에 해당된다.
  
  외래키가 성립하기 위해서는 참조하고 참조되는 양쪽 릴레이션의 도메인이 서로 같아야 한다. 또한 참조되는 릴레이션의 기본키 값이 변경되면, 이를 참조하는 외래키 또한 변경되어야 한다. 외래키는 NULL 값을 포함할 수 있고 중복 값도 허용하며, 자기 자신의 기본키를 참조할 수도 있다. 예시는 다음과 같다.
  
  <img title="" src="https://user-images.githubusercontent.com/109272360/194719048-47acb663-6957-477b-8950-d02d49195fcc.png" alt="" data-align="center" width="517">

### 무결성 제약조건

데이터 무결성은 데이터베이스에 저장된 데이터의 일관성과 정확성을 지키는 것이다. 관계 데이터 모델의 경우, 데이터의 변동을 프로그래머가 일일이 처리하기가 어렵다. 따라서 데이터의 삽입, 수정, 삭제 등 변동이 일어날 때마다 기본적인 제약조건을 DBMS가 알아서 지켜준다면, 데이터 신뢰성 향상에 큰 도움이 된다.

- **도메인 무결성 제약조건(=도메인 제약)**
  
  릴레이션 내의 튜플들은 각 속성의 도메인에 지정된 값만을 가져야 한다.

- **개체 무결성 제약조건(=기본키 제약)**
  
  기본키는 NULL 값을 가져서는 안 되며, 릴레이션 내에 오직 하나의 값만 존재해야 한다.

- **참조 무결성 제약조건(=외래키 제약)**
  
  자식 릴레이션의 외래키는 부모 릴레이션의 기본키와 도메인이 동일해야 한다. 또한 자식 릴레이션이 참조하고 있는 값을 부모 릴레이션에서 수정 및 삭제하려고 하면, 제약조건이 지켜져야 한다. 그 옵션은 다음과 같다.
  
  | 명령어        | 의미                             |
  | ---------- | ------------------------------ |
  | RESTRICTED | 부모 릴레이션의 삭제 작업을 거부             |
  | CASCADE    | 자식 릴레이션의 관련 튜플을 같이 삭제          |
  | DEFAULT    | 자식 릴레이션의 관련 튜플을 미리 설정해둔 값으로 변경 |
  | NULL       | 자식 릴레이션의 관련 튜플을 NULL값으로 설정     |

- **UNIQUE 제약조건(=유일성 제약조건, 고유성 제약조건)**
  
  특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우, 속성의 모든 값들은 서로 다른 값을 가져야 한다. (NULL 값은 허용)

## 3. 관계대수

관계대수: 어떤 데이터를 어떻게 찾는지에 대한 처리 절차를 명시하는 절차적 언어

관계해석: 어떤 데이터를 찾는지만 명시하는 선언적 언어

SQL 언어는 관계대수와 관계해석 개념을 혼합해서 사용한다.

### 관계대수

릴레이션에서 원하는 결과를 얻기 위해 수학의 대수와 같은 연산을 이용하여 질의하는 방법을 기술하는 언어이다. 

릴레이션 간의 연산 시 두 릴레이션이 동일한 속성 이름을 가지고 있을 경우, '<릴레이션 이름>.<속성 이름>'의 형태로 표현하거나 순서(위치)를 사용하여 표현한다.

**관계대수식**

단항 연산자: 연산자<조건> 릴레이션

이항 연산자: 릴레이션1 연산자<조건> 릴레이션2

**관계대수 연산자**

순수 관계 연산: 셀렉션, 프로젝션, 조인, 디비전, 개명

일반 집합 연산: 합집합, 차집합, 교집합, 카티전 프로덕트

| 연산자 종류  | 대상  | 연산자 이름     | 기호            | 설명                                                |
| ------ | --- | ---------- | ------------- | ------------------------------------------------- |
| 기본     | 단항  | 셀렉션        | σ             | 조건에 만족하는 튜플을 선택                                   |
| 기본     | 단항  | 프로젝션       | π             | 릴레이션의 속성을 선택                                      |
| 추가     | 단항  | 개명         | ρ             | 릴레이션이나 속성의 이름을 변경                                 |
| 유도     | 이항  | 디비전        | ÷             | 분모에 포함된 튜플을 모두 가지는 분자의 튜플 중에, 분모에 포함된 속성을 제거하고 반환 |
| 기본     | 이항  | 합집합        | ∪             | 두 릴레이션의 합집합                                       |
| 기본     | 이항  | 차집합        | -             | 두 릴레이션의 차집합                                       |
| 유도     | 이항  | 교집합        | ∩             | 두 릴레이션의 교집합                                       |
| 기본     | 이항  | 카티전 프로덕트   | ×             | 두 릴레이션에 속한 모든 튜플의 집합                              |
| 유도     | 이항  | 조인 - 세타    | ⋈<sub>θ</sub> | 두 릴레이션 간의 비교 조건에 만족하는 집합                          |
| 유도     | 이항  | 조인 - 동등    | ⋈             | 두 릴레이션 간의 같은 값을 가진 집합                             |
| 유도     | 이항  | 조인 - 자연    | ⋈<sub>N</sub> | 동등조인에서 중복 속성을 제거                                  |
| 유도     | 이항  | 조인-세미(왼쪽)  | ⋉             | 자연조인 후 오른쪽 속성을 제거                                 |
| 유도     | 이항  | 조인-세미(오른쪽) | ⋊             | 자연조인 후 왼쪽 속성을 제거                                  |
| 유도     | 이항  | 조인-외부(왼쪽)  | ⟕             | 자연조인 후 왼쪽의 모든 값을 결과로 추출                           |
| 유도     | 이항  | 조인-외부(오른쪽) | ⟖             | 자연조인 후 왼쪽의 모든 값을 결과로 추출                           |
| 유도     | 이항  | 조인-외부(양쪽)  | ⟗             | 자연조인 후 왼쪽의 모든 값을 결과로 추출                           |

### 셀렉션과 프로젝션

**셀렉션**: σ<sub>조건</sub> (R)   (R: 릴레이션) 

릴레이션의 튜플 중, 조건을 만족하는 튜플을 추출하기 위한 연산이다.

조건이 여러 개라면, **∧**(and), ∨(or), ¬(not) 기호를 이용하여 표현할 수 있다.

ex) σ<sub>가격<=8000∧도서번호<=2</sub> (도서)

**프로젝션**: π<sub><속성리스트></sub> (R)

릴레이션의 속성을 추출하기 위한 연산이다.

ex) π<sub>이름, 거주지</sub> (고객)

### 집합 연산

**합집합**: R∪S   (R: 릴레이션1, S: 릴레이션2)

서로 동일한 속성과 동일한 도메인을 가지는 두 릴레이션을 합병한 뒤 반환한다. (중복된 튜플은 삭제)

**교집합**: R∩S

서로 동일한 속성과 동일한 도메인을 가지는 두 릴레이션이 공통으로 가지고 있는 튜플을 반환한다.

**차집합**: R-S

R 릴레이션에는 속하고 S 릴레이션에는 속하지 않는 튜플을 반환한다. 두 릴레이션 역시 동일한 속성과 도메인을 가져야 한다.

**카티전 프로덕트**: R×S

R 릴레이션의 오른쪽에 S 릴레이션의 모든 튜플을 순서대로 배열하여 반환한다. 다른 연산과 달리, 두 릴레이션의 속성과 도메인이 동일할 필요는 없다.

### 조인

두 릴레이션의 공통 속성을 기준으로 속성 값이 같은 튜플을 수평으로 결합하는 연산이다. 즉, 두 릴레이션을 카티전 프로덕트 연산을 한 후 셀렉션 연산을 한 것으로 정의할 수 있다.

**세타조인**: R ⋈<sub>(r 조건 s)</sub> S   (R: 릴레이션1, S: 릴레이션2, r: R의 속성, s: S의 속성)

두 릴레이션의 속성 값을 비교하여, 조건을 만족하는 튜플만 반환한다. 세타조인의 조건은 (=, ≠, ＜, ＞, ≤, ≥) 중 하나가 된다.

**동등조인**: R ⋈<sub>(r = s)</sub> S 

세타조인에서 '=' 연산자를 사용한 조인을 말한다. 보통 조인 연산이라고 하면 동등조인을 지칭하며, 내부조인이라고도 불린다.

**자연조인**: R ⋈<sub>N(r, s)</sub> S

동등조인에서 참여한 속성이 속성이 두 번 나오지 않도록 중복을 제거한 결과를 반환한다. 따라서 자연조인의 결과 차수는 '두 릴레이션의 차수의 합 - 1'이다.

**외부조인**:

자연조인 시 조인에 실패한 튜플을 모두 보여주되 값이 없는 대응 속성에는 NULL 값을 채워서 반환한다. 기준 릴레이션의 위치에 따라 왼쪽 외부조인, 오른쪽 외부조인, 완전 외부 조인으로 나뉜다.

왼쪽 외부조인: R ⟕<sub>(r, s)</sub> S

오른쪽 외부조인: R ⟖<sub>(r, s)</sub> S

완전 외부조인: R ⟗<sub>(r, s)</sub> S

**세미조인**: 

자연조인을 한 후 두 릴레이션 중 한쪽 릴레이션의 결과만 반환한다.

왼쪽 세미조인: R⋉<sub>(r, s)</sub> S

오른쪽 세미조인: R ⋊<sub>(r, s)</sub> S

### 디비전

**디비전**: R÷S   (R: 릴레이션1, S: 릴레이션2)

S에 포함된 튜플을 모두 가지는 R의 튜플 중에, S에 포함된 속성을 제거하고 반환한다.